<a mat-button routerLink="/"><mat-icon>arrow_back</mat-icon> Back to list</a>

@if (loading()) {
  <div class="center"><mat-spinner diameter="40" /></div>
} @else if (error()) {
  <p class="error">{{ error() }}</p>
} @else if (person()) {
  <h2>{{ person()!.name }}</h2>

  <mat-card>
    <mat-card-content>
      <div class="info-grid">
        <div><strong>Current Rank:</strong> {{ person()!.currentRank || '—' }}</div>
        <div><strong>Current Duty:</strong> {{ person()!.currentDutyTitle || '—' }}</div>
        <div><strong>Career Start:</strong> {{ person()!.careerStartDate ? (person()!.careerStartDate | date:'mediumDate') : '—' }}</div>
        <div><strong>Career End:</strong> {{ person()!.careerEndDate ? (person()!.careerEndDate | date:'mediumDate') : '—' }}</div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="header-row">
    <h3>Duty History</h3>
    <a mat-raised-button color="primary" [routerLink]="['/duty/create', person()!.name]">
      <mat-icon>assignment</mat-icon> Assign Duty
    </a>
  </div>

  @if (duties().length === 0) {
    <p>No duties assigned yet.</p>
  } @else {
    <table mat-table [dataSource]="duties()">
      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef>Rank</th>
        <td mat-cell *matCellDef="let duty">{{ duty.rank }}</td>
      </ng-container>

      <ng-container matColumnDef="dutyTitle">
        <th mat-header-cell *matHeaderCellDef>Duty Title</th>
        <td mat-cell *matCellDef="let duty">{{ duty.dutyTitle }}</td>
      </ng-container>

      <ng-container matColumnDef="dutyStartDate">
        <th mat-header-cell *matHeaderCellDef>Start Date</th>
        <td mat-cell *matCellDef="let duty">{{ duty.dutyStartDate | date:'mediumDate' }}</td>
      </ng-container>

      <ng-container matColumnDef="dutyEndDate">
        <th mat-header-cell *matHeaderCellDef>End Date</th>
        <td mat-cell *matCellDef="let duty">{{ duty.dutyEndDate ? (duty.dutyEndDate | date:'mediumDate') : 'Active' }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="dutyColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: dutyColumns;"></tr>
    </table>
  }
}
